<app-navbar></app-navbar>

<div class="promptle-container">
  <h1 style="text-align: center;">
    Promptle <br><br> {{ topic }}
  </h1>

  <!-- Loading / errors -->
  <div *ngIf="gameLoading" class="loading-container">
    <img src="loading.gif" alt="Loading" />
  </div>
  <div *ngIf="gameError" class="error">{{ gameError }}</div>

  <!-- Backend preview (single correct answer row) -->
  <div *ngIf="!gameLoading && !gameError && correctAnswer && correctAnswer.values.length" hidden>
    <h2 style="text-align:center;">Current Answer (from backend)</h2>

    <div class="game-grid single-row">
      <div class="column" *ngFor="let header of headers; let i = index">
        <div class="header">{{ header }}</div>

        <div class="guess-cell backend-cell">
          {{ correctAnswer.values[i] }}
        </div>
      </div>
    </div>
  </div>

  <!-- Guess Input -->
<div class="guess-input" *ngIf="answers.length">
  <mat-form-field appearance="fill" class="guess-select-field">
    <mat-label>Select a Guess</mat-label>
    <mat-select [(ngModel)]="selectedGuess">
      <mat-option *ngFor="let answer of answers" [value]="answer.name">
        {{ answer.name }}
      </mat-option>
    </mat-select>
  </mat-form-field>


  <button
    matButton="filled"
    [disabled]="!selectedGuess"
    (click)="onSubmitGuess()"
  >
    SUBMIT
  </button>
  
  <!-- Save progress button -->
  <button matButton="outlined" (click)="saveGame()" [disabled]="!answers.length">SAVE</button>
  <button matButton="text" (click)="restartGame()" [disabled]="!answers.length" style="margin-left:8px;">RESTART</button>
  <span *ngIf="savedTimestamp" style="margin-left:8px; font-size:0.9em; color: #666;">Saved: {{ savedTimestamp }}</span>
</div>

  <!-- Game Grid -->
  <div class="game-grid" *ngIf="headers.length">
    <div class="column" *ngFor="let header of headers; let i = index">
      <div class="header">{{ header }}</div>

      <div
        class="guess-cell"
        *ngFor="let guess of submittedGuesses"
        [style.background-color]="guess.colors[i]"
      >
        {{ guess.values[i] }}
      </div>
    </div>
  </div>
<!-- 
  <div class="settings-container">
    <button class="settings-button" (click)="toggleSettingsMenu()">
      ‚öôÔ∏è
    </button>

    <div class="settings-menu" *ngIf="showSettingsMenu">
      <button class="settings-item" (click)="quitGame()">Quit Game</button>
    </div>
  </div>

</div>
-->
<div class="win-overlay" *ngIf="isGameOver">
  <div class="win-card">
    <h2>üèÜ Victory!</h2>
    <p>The correct answer was <strong>{{ correctAnswer.name }}</strong></p>
    <div style="display:flex; gap:8px; justify-content:center; margin-top:12px;">
      <button mat-raised-button color="primary" (click)="quitGame()">Return Home</button>
      <button mat-stroked-button color="accent" (click)="restartGame()">Play Again (Different Answer)</button>
    </div>
  </div>
</div>


